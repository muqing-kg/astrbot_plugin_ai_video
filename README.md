# AstrBot AI 视频生成插件

本插件允许您的 AstrBot 接入 **Sora** 和 **Grok** 双引擎，提供高质量的 **文生视频** 和 **图生视频** 功能。

## 功能特性

### 支持的引擎

| 引擎 | 文生视频 | 图生视频 | 说明 |
|------|----------|----------|------|
| **Sora** | ✅ | ✅ | 支持横屏/竖屏、10/15/25秒时长选择 |
| **Grok** | ❌ | ✅ | 仅支持图生视频 |

### 核心功能
- **文生视频**：根据文本提示词生成视频（Sora）
- **图生视频**：结合图片和文本提示词生成动态视频（Sora + Grok）
- **自动方向识别**：图生视频时自动识别原图是横屏还是竖屏
- **方向控制**：支持在指令中指定横屏或竖屏参数
- **时长控制**：支持指定视频时长（10秒、15秒或25秒）

### 管理功能
- **权限控制**：内置用户/群组黑白名单系统

## 安装说明

### 前置条件
- 已安装并正常运行的 **AstrBot**
- **Python 3.8+** 环境
- **Sora2API** 或 **Grok API** 服务的访问地址和 API Key

## 使用方法

### Sora 文生视频

**基本格式**：`/sora [方向] [时长] 提示词`

**参数说明**：
- `方向`：可选，支持 `横`/`横屏`/`竖`/`竖屏`
- `时长`：可选，支持 `10`/`15`/`25`，默认25秒

**示例**：
- `/sora 一只奔跑在雪地里的狗`
- `/sora 横屏 一只奔跑在雪地里的狗`
- `/sora 横屏 10 一个飞机在高空飞行`

### Sora 图生视频

**基本格式**：`/sora [时长] 提示词` + 发送图片或引用图片

**说明**：
- 自动识别图片方向（横屏/竖屏）
- 时长参数可选，支持 `10`/`15`/`25`，默认25秒

**示例**：
- `/sora 一只奔跑的狗` + 发送一张图片

### Grok 图生视频

**基本格式**：`/grok <提示词>` + 发送图片或引用图片

**说明**：
- Grok 仅支持图生视频，必须提供图片
- 无方向和时长控制参数

**示例**：
- `/grok 让画面动起来` + 发送一张图片

### 帮助指令

**查看帮助**：`/视频帮助`

## 配置说明

### Sora 配置（必填其一）
| 配置项 | 说明 |
|--------|------|
| `sora_enabled` | 是否启用 Sora 引擎（默认：true） |
| `sora_api_url` | Sora2API 服务地址 |
| `sora_api_key` | Sora2API 密钥 |
| `sora_model` | 默认模型（默认：`sora2-landscape-25s`） |

### Grok 配置（可选）
| 配置项 | 说明 |
|--------|------|
| `grok_enabled` | 是否启用 Grok 引擎（默认：true） |
| `grok_api_url` | Grok API 服务地址 |
| `grok_api_key` | Grok API 密钥 |
| `grok_model` | Grok 模型 ID（默认：`grok-imagine-0.9`） |

### 权限配置
| 配置项 | 说明 |
|--------|------|
| `user_whitelist` | 用户白名单 |
| `user_blacklist` | 用户黑名单 |
| `group_whitelist` | 群组白名单 |
| `group_blacklist` | 群组黑名单 |

## Sora 模型说明

| 模型名称 | 类型 | 时长 |
|---------|------|------|
| `sora2-landscape-10s` | 横屏 | 10秒 |
| `sora2-landscape-15s` | 横屏 | 15秒 |
| `sora2-landscape-25s` | 横屏 | 25秒（默认） |
| `sora2-portrait-10s` | 竖屏 | 10秒 |
| `sora2-portrait-15s` | 竖屏 | 15秒 |
| `sora2-portrait-25s` | 竖屏 | 25秒 |

## 常见问题

### Q: 为什么发送视频指令后机器人没有反应？
A: 请检查以下几点：
- 您是否已正确配置了 API Key 和 API URL
- 您的账号是否在白名单中（如果白名单不为空）
- 您所在的群组是否在白名单中（如果白名单不为空）
- 您的账号是否在黑名单中
- 您所在的群组是否在黑名单中

### Q: Grok 和 Sora 有什么区别？
A: 
- Sora 支持文生视频和图生视频，可控制方向和时长
- Grok 仅支持图生视频，无方向和时长控制

## 更新日志

### v3.0.0
- 🎉 新增 Grok 视频生成引擎支持
- 新增 `/grok` 命令用于 Grok 图生视频
- 更新帮助信息，整合双引擎说明
- 配置项整理，Sora 和 Grok 配置分离

### v2.0.0
- 重构插件以适配 Sora2API
- 支持完整的模型选择逻辑
- 优化图片方向检测功能
- 完善方向和时长参数控制

## 技术说明

### 依赖管理
插件依赖已整理到 requirements.txt 文件中：
- aiohttp>=3.8.0: 用于异步 HTTP 请求
- aiofiles>=22.1.0: 用于异步文件操作
- Pillow>=9.0.0: 用于图像处理
- astrbot>=1.0.0: 核心框架

### 缓存机制
插件会在视频发送后自动清理临时文件，无需手动管理。

## 许可证

本项目采用 MIT 许可证。详见 LICENSE 文件。
